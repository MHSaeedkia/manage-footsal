# راهنمای سریع راه‌اندازی

## گام‌های اجرا

### 1. نصب پیش‌نیازها

مطمئن شوید که Docker و Docker Compose نصب شده‌اند:

```bash
docker --version
docker-compose --version
```

### 2. دریافت Token ربات

1. به [@BotFather](https://t.me/botfather) در تلگرام پیام دهید
2. دستور `/newbot` را ارسال کنید
3. نام و username دلخواه را وارد کنید
4. Token دریافتی را کپی کنید

### 3. دریافت User ID

1. به [@userinfobot](https://t.me/userinfobot) پیام دهید
2. User ID خود را کپی کنید (عددی مثل 123456789)

### 4. تنظیم فایل محیطی

```bash
# کپی کردن فایل نمونه
cp .env.example .env

# ویرایش فایل .env
nano .env
# یا
vim .env
```

حداقل این مقادیر را تغییر دهید:
- `BOT_TOKEN`: Token از BotFather
- `DEFAULT_ADMIN_ID`: User ID شما
- `DB_PASSWORD`: یک رمز عبور قوی

### 5. اجرای پروژه

```bash
# ساخت و اجرای سرویس‌ها
docker-compose up -d

# مشاهده لاگ‌ها
docker-compose logs -f
```

### 6. اضافه کردن ربات به گروه

1. ربات را در تلگرام پیدا کنید (با username که در BotFather تنظیم کردید)
2. ربات را به گروه دلخواه خود اضافه کنید
3. دسترسی ارسال پیام را به ربات بدهید

### 7. ثبت نام

1. به صورت خصوصی به ربات پیام `/start` بدهید
2. دکمه "ثبت نام" را بزنید
3. نام خود را وارد کنید
4. نقش خود را انتخاب کنید

### 8. تنظیم نرخ‌ها (فقط ادمین)

1. در پیام خصوصی ربات، دکمه "تعیین نرخ" را بزنید
2. نقش مورد نظر را انتخاب کنید
3. نرخ به تومان را وارد کنید

### 9. ثبت حضور و غیاب (در گروه)

```bash
/attendance [user_id1] [user_id2] ...
```

مثال:
```bash
/attendance 123456789 987654321
```

### 10. مشاهده گزارش (در گروه)

```bash
/report
```

## نکات مهم

### دریافت User ID افراد

برای ثبت حضور و غیاب، به User ID افراد نیاز دارید. راه‌های دریافت:

1. از خود فرد بخواهید به [@userinfobot](https://t.me/userinfobot) پیام دهد
2. از فرد بخواهید `/start` را در ربات شما بزند و نام خود را ثبت کند
3. سپس می‌توانید در گزارش `/report` User ID او را ببینید

### امکانات ادمین

به عنوان ادمین می‌توانید:
- نرخ‌ها را تعیین کنید
- حضور و غیاب ثبت کنید
- گزارش بدهی‌ها را ببینید
- تسویه حساب کاربران را انجام دهید
- رکوردهای اشتباه را Revert کنید (تا 1 ساعت)

### Revert کردن حضور و غیاب اشتباه

اگر متوجه شدید که لیست حضور و غیاب اشتباه است، تا 1 ساعت می‌توانید آن را بازگردانی کنید:

```bash
/revert [شناسه رکورد]
```

شناسه رکورد در پیام ثبت حضور و غیاب نمایش داده می‌شود.

## دستورات مفید Docker

```bash
# مشاهده وضعیت سرویس‌ها
docker-compose ps

# مشاهده لاگ‌های ربات
docker-compose logs -f bot

# مشاهده لاگ‌های دیتابیس
docker-compose logs -f postgres

# راه‌اندازی مجدد
docker-compose restart

# متوقف کردن
docker-compose down

# حذف کامل (با دیتاها)
docker-compose down -v
```

## استفاده از Makefile (اختیاری)

اگر `make` نصب دارید:

```bash
# راه‌اندازی
make up

# مشاهده لاگ‌ها
make logs

# متوقف کردن
make down

# حذف کامل
make clean
```

## عیب‌یابی

### ربات پاسخ نمی‌دهد

1. بررسی لاگ‌ها: `docker-compose logs bot`
2. مطمئن شوید Token صحیح است
3. اتصال اینترنت را بررسی کنید

### خطای دیتابیس

1. بررسی لاگ‌های PostgreSQL: `docker-compose logs postgres`
2. مطمئن شوید رمز عبور در `.env` صحیح است
3. راه‌اندازی مجدد: `docker-compose restart`

### ربات در گروه کار نمی‌کند

1. مطمئن شوید ربات را به گروه اضافه کرده‌اید
2. به ربات دسترسی ارسال پیام داده‌اید
3. ربات را Admin گروه کرده‌اید (توصیه می‌شود)

## سوالات متداول

**س: چگونه ادمین جدید اضافه کنم؟**

ج: به عنوان ادمین اولیه، می‌توانید از طریق دکمه ثبت نام، نقش Admin را به افراد دیگر بدهید.

**س: آیا یک نفر می‌تواند در چند گروه عضو باشد؟**

ج: بله، هر فرد می‌تواند با نقش‌های مختلف در گروه‌های مختلف عضو باشد.

**س: چگونه بدهی یک نفر را صفر کنم؟**

ج: از دکمه "تسویه حساب کاربر" استفاده کنید و تمام جلسات بدهی را وارد کنید.

**س: آیا می‌توانم نرخ‌ها را تغییر دهم؟**

ج: بله، می‌توانید هر زمان نرخ‌ها را تغییر دهید. نرخ جدید فقط روی محاسبات آینده تاثیر می‌گذارد.

## پشتیبانی

برای مشکلات یا سوالات، لطفاً یک Issue در GitHub ایجاد کنید.
