# ุฎูุงุตู ูพุฑูฺู ุฑุจุงุช ูุฏุฑุช ููุชุณุงู

## ููุง ฺฉู

ุงู ูพุฑูฺู ฺฉ ุฑุจุงุช ุชูฺฏุฑุงู ฺฉุงูู ุจุฑุง ูุฏุฑุช ุฌูุณุงุช ููุชุณุงู ุงุณุช ฺฉู ุจุง Go ููุดุชู ุดุฏู ู ุงุฒ PostgreSQL ุจู ุนููุงู ุฏุชุงุจุณ ุงุณุชูุงุฏู ูโฺฉูุฏ. ุชูุงู ูุงุจูุชโูุง ุฏุฑุฎูุงุณุช ุดูุง ูพุงุฏูโุณุงุฒ ุดุฏู ุงุณุช.

## ุณุงุฎุชุงุฑ ูพุฑูฺู

```
futsal-bot/
โโโ cmd/bot/main.go                          # ููุทู ูุฑูุฏ ุงุตู ุจุฑูุงูู
โโโ internal/
โ   โโโ bot/bot.go                           # ูุงุฌฺฉ ุงุตู ุฑุจุงุช ู ูุฏุฑุช state
โ   โโโ database/
โ   โ   โโโ database.go                      # ุงุชุตุงู ุจู ุฏุชุงุจุณ ู ูุงฺฏุฑุดู
โ   โ   โโโ repository.go                    # ุชูุงู ุนููุงุช CRUD
โ   โโโ handlers/
โ   โ   โโโ handlers.go                      # ููุฏูุฑูุง ุงุตู (ุซุจุช ูุงูุ ูุฑุงุดุ ุตูุฑุชุญุณุงุจ)
โ   โ   โโโ handlers_admin.go                # ููุฏูุฑูุง ุงุฏูู (ูุฑุฎุ ุชุณููุ ุญุถูุฑ ู ุบุงุจ)
โ   โโโ models/models.go                     # ูุฏูโูุง ุฏุงุฏู
โโโ migrations/                              # ูุงฺฏุฑุดูโูุง ุฏุชุงุจุณ
โ   โโโ 001_create_users.sql                 # ุฌุฏูู ฺฉุงุฑุจุฑุงู
โ   โโโ 002_create_groups.sql                # ุฌุฏูู ฺฏุฑููโูุง/ฺฉูุงุณโูุง
โ   โโโ 003_create_user_groups.sql           # ุฌุฏูู ุนุถูุชโูุง
โ   โโโ 004_create_rates.sql                 # ุฌุฏูู ูุฑุฎโูุง
โ   โโโ 005_create_attendance_records.sql    # ุฌุฏูู ุฑฺฉูุฑุฏูุง ุญุถูุฑ ู ุบุงุจ
โโโ docker-compose.yml                       # ุชูุธูุงุช Docker Compose
โโโ Dockerfile                               # ุชูุธูุงุช ุชุตูุฑ Docker
โโโ go.mod                                   # ูุงุจุณุชฺฏโูุง Go
โโโ go.sum                                   # checksums ูุงุจุณุชฺฏโูุง
โโโ .env.example                             # ููููู ูุงู ุชูุธูุงุช
โโโ .gitignore                               # ูุงูโูุง ูุงุฏุฏู ฺฏุฑูุชู ุดุฏู ุชูุณุท Git
โโโ Makefile                                 # ุฏุณุชูุฑุงุช ฺฉูฺฉ
โโโ README.md                                # ูุณุชูุฏุงุช ฺฉุงูู
โโโ QUICKSTART.md                            # ุฑุงูููุง ุณุฑุน ุดุฑูุน
```

## ูุงุจูุชโูุง ูพุงุฏูโุณุงุฒ ุดุฏู

### โ ุงูุฒุงูุงุช ุฒุฑุณุงุฎุช
- [x] Dockerized ุจุง docker-compose
- [x] ูุงฺฏุฑุดู ุฎูุฏฺฉุงุฑ ููฺฏุงู startup
- [x] ุณุงุฎุช ุฎูุฏฺฉุงุฑ ุฏุชุงุจุณ ู ุฌุฏุงูู
- [x] ุงุฌุฑุง ููุฒูุงู PostgreSQL ู ุณุฑูุณ
- [x] ูพูุฑุชโูุง expose ุดุฏู ุฏุฑ localhost
- [x] ุชูุงู ูพุงุฑุงูุชุฑูุง ุฏุฑ .env (ุจุฏูู hardcode)

### โ ูุฏุฑุช ฺฉุงุฑุจุฑุงู
- [x] ฺูุงุฑ ููุด: Adminุ Studentุ Adultุ Half Adult
- [x] ููุท Admin ูโุชูุงูุฏ ฺฉุงุฑุจุฑ ุงุถุงูู ฺฉูุฏ
- [x] ุดูุง ุจู ุตูุฑุช ูพุดโูุฑุถ Admin ูุณุชุฏ
- [x] ุซุจุช ูุงู ู ูุฑุงุด ูุดุฎุตุงุช ุฏุฑ PV
- [x] ูุฑ Admin ูโุชูุงูุฏ ุจู ุนููุงู ููุด ุบุฑ Admin ูู ุนุถู ุดูุฏ

### โ ูุฏุฑุช ูุงู
- [x] ุชุนู ูุฑุฎ ุจุฑุง ูุฑ ููุด ุชูุณุท Admin
- [x] ูพฺฏุฑ ุฌูุณุงุช ุจุฏูฺฉุงุฑ ูุฑ ฺฉุงุฑุจุฑ
- [x] ูุญุงุณุจู ุฎูุฏฺฉุงุฑ ูุฌููุน ุจุฏู
- [x] ููุงุด ุตูุฑุชุญุณุงุจ ุจุฑุง ฺฉุงุฑุจุฑุงู
- [x] ุชุณูู ุญุณุงุจ ุชูุณุท Admin

### โ ูุฏุฑุช ฺฏุฑูู
- [x] ุนุถูุช ุฑุจุงุช ุฏุฑ ฺูุฏู ฺฏุฑูู
- [x] ูุฑ ฺฏุฑูู ุจู ุนููุงู ฺฉ ฺฉูุงุณ ูุฌุฒุง
- [x] endpoint ุญุถูุฑ ู ุบุงุจ (ููุท Admin)
- [x] endpoint revert ุจุง time limit 1 ุณุงุนุช
- [x] endpoint ฺฏุฒุงุฑุด ุจุฏูโูุง ฺฏุฑูู
- [x] ฺฉุงุฑุจุฑุงู ูโุชูุงููุฏ ุนุถู ฺูุฏู ฺฉูุงุณ ุจุงุดูุฏ

### โ ุงููุช ู ุฏุณุชุฑุณ
- [x] ููุท ุงุนุถุง ฺฏุฑููโูุง ูโุชูุงููุฏ ุงุฒ PV ุงุณุชูุงุฏู ฺฉููุฏ
- [x] ูุญุฏูุฏุช ุฏุณุชุฑุณ Admin ุจุฑุง ุฏุณุชูุฑุงุช ุฎุงุต

## ูุงูโูุง ฺฉูุฏ ู ุชูุถุญุงุช

### 1. docker-compose.yml
ุชูุธูุงุช ุงุฌุฑุง ุณุฑูุณโูุง:
- ุณุฑูุณ PostgreSQL ุจุง healthcheck
- ุณุฑูุณ bot ฺฉู ููุชุธุฑ ุขูุงุฏู ุดุฏู ุฏุชุงุจุณ ูโูุงูุฏ
- volumes ุจุฑุง ูฺฏูุฏุงุฑ ุฏุชุง
- networks ุจุฑุง ุงุฑุชุจุงุท ุณุฑูุณโูุง

### 2. Dockerfile
ุณุงุฎุช ุชุตูุฑ Go:
- Multi-stage build ุจุฑุง ฺฉุงูุด ุญุฌู
- ฺฉูพ ฺฉุฑุฏู ููุท ูุงูโูุง ุถุฑูุฑ
- ุณุงุฎุช binary ุจุฏูู CGO

### 3. cmd/bot/main.go
ููุทู ูุฑูุฏ ุจุฑูุงูู ฺฉู:
- ูุญุท ุฑุง configure ูโฺฉูุฏ
- ุจู ุฏุชุงุจุณ ูุชุตู ูโุดูุฏ
- ูุงฺฏุฑุดูโูุง ุฑุง ุงุฌุฑุง ูโฺฉูุฏ
- ุฑุจุงุช ุฑุง ุฑุงูโุงูุฏุงุฒ ูโฺฉูุฏ
- updateโูุง ุชูฺฏุฑุงู ุฑุง ูพุฑุฏุงุฒุด ูโฺฉูุฏ

### 4. internal/database/database.go
ูุฏุฑุช ุฏุชุงุจุณ:
- ุงุชุตุงู ุจู PostgreSQL
- ุงุฌุฑุง ุฎูุฏฺฉุงุฑ ูุงฺฏุฑุดูโูุง
- ุงุณุชูุงุฏู ุงุฒ embed.FS ุจุฑุง ูุงูโูุง SQL

### 5. internal/database/repository.go
ุชูุงู ุนููุงุช ุฏุชุงุจุณ:
- CRUD ุจุฑุง usersุ groupsุ user_groups
- ูุฏุฑุช rates
- ูุฏุฑุช sessions (ุงุถุงูู ฺฉุฑุฏู ู ุชุณูู)
- ูุฏุฑุช attendance records ุจุง revert

### 6. internal/bot/bot.go
ูุงุฌฺฉ ุงุตู ุฑุจุงุช:
- ูุฏุฑุช state ุจุฑุง conversation flows
- keyboard builders
- helper functions ุจุฑุง ุงุฑุณุงู ูพุงู
- ุจุฑุฑุณ ุฏุณุชุฑุณ Admin

### 7. internal/handlers/handlers.go
ููุฏูุฑูุง ุงุตู:
- `/start` command
- ูุฑุขูุฏ ุซุจุช ูุงู ู ูุฑุงุด
- ููุงุด ุตูุฑุชุญุณุงุจ
- ูุฏุฑุช callback queries
- input handling ุจุฑุง conversation flows

### 8. internal/handlers/handlers_admin.go
ููุฏูุฑูุง ุงุฏูู:
- ุชูุธู ูุฑุฎโูุง
- ุชุณูู ุญุณุงุจ
- ุซุจุช ุญุถูุฑ ู ุบุงุจ (`/attendance`)
- revert ุญุถูุฑ ู ุบุงุจ (`/revert`)
- ููุงุด ฺฏุฒุงุฑุด (`/report`)

### 9. migrations/*.sql
ูุงฺฏุฑุดูโูุง ุฏุชุงุจุณ ุจุง Goose:
- ูุฑ ูุงฺฏุฑุดู ุดุงูู Up ู Down ุงุณุช
- ุชุฑุชุจ ุงุฌุฑุง ุจุง ุดูุงุฑู ูุดุฎุต ูโุดูุฏ
- ุงุณุชูุงุฏู ุงุฒ enum ุจุฑุง UserRole

## ูุญูู ฺฉุงุฑฺฉุฑุฏ

### ุฌุฑุงู ุซุจุช ูุงู
1. ฺฉุงุฑุจุฑ `/start` ูโุฒูุฏ
2. ุฑุจุงุช ุจุฑุฑุณ ูโฺฉูุฏ ุขุง ฺฉุงุฑุจุฑ ูุจูุงู ุซุจุช ูุงู ฺฉุฑุฏู
3. ุงฺฏุฑ ููุ ุฏฺฉูู "ุซุจุช ูุงู" ููุงุด ุฏุงุฏู ูโุดูุฏ
4. ฺฉุงุฑุจุฑ ูุงู ุฎูุฏ ุฑุง ูุงุฑุฏ ูโฺฉูุฏ (state: awaiting_name)
5. ฺฉุงุฑุจุฑ ููุด ุฎูุฏ ุฑุง ุงูุชุฎุงุจ ูโฺฉูุฏ (state: awaiting_role)
6. ุงุทูุงุนุงุช ุฏุฑ ุฏุชุงุจุณ ุฐุฎุฑู ูโุดูุฏ

### ุฌุฑุงู ุญุถูุฑ ู ุบุงุจ
1. Admin ุฏุฑ ฺฏุฑูู ุฏุณุชูุฑ `/attendance [ids...]` ุฑุง ูโุฒูุฏ
2. ุฑุจุงุช ุจุฑุฑุณ ูโฺฉูุฏ Admin ุจุงุดุฏ
3. ุจุฑุง ูุฑ user_id ฺฉู ุนุถู ฺฏุฑูู ุงุณุช:
   - ฺฉ ุฌูุณู ุจู sessions_owed ุงุถุงูู ูโุดูุฏ
4. ฺฉ attendance_record ุงุฌุงุฏ ูโุดูุฏ
5. record_id ุจุฑุง revert ุจุฑฺฏุฑุฏุงูุฏู ูโุดูุฏ

### ุฌุฑุงู Revert
1. Admin ุฏุณุชูุฑ `/revert [record_id]` ูโุฒูุฏ
2. ุฑุจุงุช ุจุฑุฑุณ ูโฺฉูุฏ:
   - Admin ุจุงุดุฏ
   - ุฑฺฉูุฑุฏ ูุชุนูู ุจู ููู ฺฏุฑูู ุจุงุดุฏ
   - ฺฉูุชุฑ ุงุฒ 1 ุณุงุนุช ฺฏุฐุดุชู ุจุงุดุฏ
   - ูุจูุงู revert ูุดุฏู ุจุงุดุฏ
3. ุจุฑุง ูุฑ ฺฉุงุฑุจุฑ ุฏุฑ ุฑฺฉูุฑุฏุ ฺฉ ุฌูุณู ฺฉู ูโุดูุฏ
4. ุฑฺฉูุฑุฏ ุจู ุนููุงู reverted ุนูุงูุช ูโุฎูุฑุฏ

### ุฌุฑุงู ุชุณูู ุญุณุงุจ
1. Admin ุฏฺฉูู "ุชุณูู ุญุณุงุจ ฺฉุงุฑุจุฑ" ุฑุง ูโุฒูุฏ
2. ูุณุช ฺฉุงุฑุจุฑุงู ุจุง ุจุฏู ููุงุด ุฏุงุฏู ูโุดูุฏ
3. Admin ฺฉุงุฑุจุฑ ุฑุง ุงูุชุฎุงุจ ูโฺฉูุฏ
4. Admin ุชุนุฏุงุฏ ุฌูุณุงุช ุชุณูู ุดุฏู ุฑุง ูุงุฑุฏ ูโฺฉูุฏ
5. sessions_owed ฺฉุงูุด ูโุงุจุฏ

## ฺฉุชุงุจุฎุงููโูุง ุงุณุชูุงุฏู ุดุฏู

1. **telegram-bot-api** - API ุฑุจุงุช ุชูฺฏุฑุงู
2. **pq** - ุฏุฑุงูุฑ PostgreSQL
3. **goose** - ูุฏุฑุช ูุงฺฏุฑุดูโูุง ุฏุชุงุจุณ
4. **godotenv** - ุจุงุฑฺฏุฐุงุฑ ูุชุบุฑูุง ูุญุท

## ูฺฉุงุช ููู

### State Management
ุฑุจุงุช ุงุฒ ฺฉ map ุณุงุฏู ุจุฑุง ูฺฏูุฏุงุฑ state ุงุณุชูุงุฏู ูโฺฉูุฏ. ุฏุฑ production ูโุชูุงูุฏ ุงุฒ Redis ุงุณุชูุงุฏู ฺฉูุฏ.

### Transaction Safety
ุนููุงุช Revert ุฏุฑ ฺฉ transaction ุงูุฌุงู ูโุดูุฏ ุชุง consistency ุญูุธ ุดูุฏ.

### Multi-Group Support
ูุฑ ฺฏุฑูู ุจู ุตูุฑุช ูุฌุฒุง ูุฏุฑุช ูโุดูุฏ ู ฺฉุงุฑุจุฑุงู ูโุชูุงููุฏ ุจุง ููุดโูุง ูุฎุชูู ุฏุฑ ฺฏุฑููโูุง ูุฎุชูู ุนุถู ุจุงุดูุฏ.

### Time-based Revert
ุงุฒ `time.Since()` ุจุฑุง ูุญุฏูุฏุช 1 ุณุงุนุชู ุงุณุชูุงุฏู ูโุดูุฏ.

### Admin Management
- Default admin ุงุฒ ุทุฑู .env ุชูุธู ูโุดูุฏ
- Adminโูุง ุฏฺฏุฑ ูโุชูุงููุฏ ุชูุณุท adminโูุง ููุฌูุฏ ุงุถุงูู ุดููุฏ
- ูุฑ admin ูโุชูุงูุฏ ุจู ุนููุงู ฺฉุงุฑุจุฑ ุนุงุฏ ูู ุฏุฑ ฺฉูุงุณโูุง ุดุฑฺฉุช ฺฉูุฏ

## ุฑุงูโุงูุฏุงุฒ ุณุฑุน

```bash
# 1. ุชูุธู ูุงู ูุญุท
cp .env.example .env
# ูุฑุงุด .env ู ูุงุฑุฏ ฺฉุฑุฏู BOT_TOKEN ู DEFAULT_ADMIN_ID

# 2. ุงุฌุฑุง
docker-compose up -d

# 3. ูุดุงูุฏู ูุงฺฏโูุง
docker-compose logs -f bot
```

## ุชูุณุนู ุขูุฏู

ุงูฺฉุงูุงุช ูพุดููุงุฏ ุจุฑุง ูุณุฎูโูุง ุจุนุฏ:
- ูพุฑุฏุงุฎุช ุขููุงู
- ฺฏุฒุงุฑุดโูุง Excel
- ุงุฏุขูุฑ ุฎูุฏฺฉุงุฑ ุจู ฺฉุงุฑุจุฑุงู ุจุฏูฺฉุงุฑ
- ุขูุงุฑ ู ูููุฏุงุฑ ุจุฑุง Admin
- Backup ุฎูุฏฺฉุงุฑ ุฏุชุงุจุณ
- ูพูู ูุจ Admin
- ููุชูฺฉุดู ุจุฑุง ุฑูุฏุงุฏูุง

## ูพุดุชุจุงู ู ุชูุณุนู

ุจุฑุง ุณูุงูุงุช ุง ูุดฺฉูุงุช:
1. ุงุจุชุฏุง QUICKSTART.md ุฑุง ูุทุงูุนู ฺฉูุฏ
2. ูุงฺฏโูุง ุฑุง ุจุง `docker-compose logs` ุจุฑุฑุณ ฺฉูุฏ
3. ูุณุชูุฏุงุช README.md ุฑุง ูุทุงูุนู ฺฉูุฏ

ูููู ุจุงุดุฏ! ๐
